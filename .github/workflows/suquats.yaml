name: Squat Challenge

on:
  schedule:
    # JST Âπ≥Êó• 09:00,12:00,15:00,18:00  ‚Üí UTC Âπ≥Êó• 00:00,03:00,06:00,09:00
    - cron: "0 0,3,6,9 * * 1-5"
    # JST Âπ≥Êó• 09:45,12:45,15:45 ‚Üí UTC Âπ≥Êó• 00:45,03:45,06:45
    - cron: "45 0,3,6 * * 1-5"
    # JST Âπ≥Êó• 10:30,13:30,16:30 ‚Üí UTC Âπ≥Êó• 01:30,04:30,07:30
    - cron: "30 1,4,7 * * 1-5"
    # JST Âπ≥Êó• 11:15,14:15,17:15 ‚Üí UTC Âπ≥Êó• 02:15,05:15,08:15
    - cron: "15 2,5,8 * * 1-5"
  workflow_dispatch: {}

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Post to Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          set -euo pipefail
          if [ -z "${SLACK_WEBHOOK_URL}" ]; then
            echo "Error: SLACK_WEBHOOK_URL is not set"
            exit 1
          fi
          TIMESTAMP=$(TZ=Asia/Tokyo date '+%Y-%m-%d %H:%M:%S JST')
          payload="{\"text\":\"üî• Squat Challenge\",\"blocks\":[{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"üî• *Squat Challenge*\\n\\n10 reps\"}},{\"type\":\"context\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"‚è∞ ${TIMESTAMP}\"}]}]}"
          curl -sS -X POST \
            -H 'Content-type: application/json' \
            --data "${payload}" \
            "${SLACK_WEBHOOK_URL}"
