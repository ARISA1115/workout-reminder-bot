name: Squat Challenge

on:
  schedule:
    # JST Âπ≥Êó• 09:00,10:00,11:00,12:00,13:00,14:00,15:00,16:00,17:00,18:00 ‚Üí UTC Âπ≥Êó• 00:00,01:00,02:00,03:00,04:00,05:00,06:00,07:00,08:00,09:00
    - cron: "0 0,1,2,3,4,5,6,7,8,9 * * 1-5"
  workflow_dispatch: {}

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Post to Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          set -euo pipefail
          if [ -z "${SLACK_WEBHOOK_URL}" ]; then
            echo "Error: SLACK_WEBHOOK_URL is not set"
            exit 1
          fi
          TIMESTAMP=$(TZ=Asia/Tokyo date '+%Y-%m-%d %H:%M:%S JST')
          payload="{\"text\":\"üî• Squat & Lunges Challenge\",\"blocks\":[{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\"üî• *Squat & Lunges Challenge*\\n\\n„Çπ„ÇØ„ÉØ„ÉÉ„Éà: 10Âõû\\n„É©„É≥„Ç∏: 10Âõû\"}},{\"type\":\"context\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"‚è∞ ${TIMESTAMP}\"}]}]}"
          curl -sS -X POST \
            -H 'Content-type: application/json' \
            --data "${payload}" \
            "${SLACK_WEBHOOK_URL}"
